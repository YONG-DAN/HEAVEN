<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="join">
	<resultMap type="joinPostVO" id="jpRM">
 		<result column="id"  property="userVO.id"/>
 		<result column="jp_group_no"  property="joinPostGroupVO.jpGroupNo"/>
 		<result column="jp_progress" property="joinPostStatusVO.jpStuatusNo"/>
 	</resultMap>
 	
 	<!-- 신청서 -->
	<insert id="application" parameterType="joinPostVO">
		<selectKey keyProperty="jpNo" resultType="int" order="BEFORE">
 			select join_post_seq.nextval from dual
 		</selectKey>
		insert into join_post(jp_no, jp_title, jp_contents, jp_summary, <if test="jpPlace!=null">jp_place,</if> jp_app_start_date, jp_app_end_date,
		<if test="jpEventStartDate!=null">jp_event_start_date,</if> <if test="jpEventEndDate!=null">jp_event_end_date,</if> jp_imgdirectory, jp_regdate, 
		<if test="goalMileage!=null">jp_goal_mileage,</if> <if test="goalEntry!=null">jp_goal_entry,</if> id, jp_group_no)
		values(#{jpNo}, #{jpTitle}, #{jpContents}, #{jpSummary}, #{jpPlace}, #{jpAppStartDate}, #{jpAppEndDate},
		#{jpEventStartDate}, #{jpEventEndDate}, #{jpImgDirect}, sysdate,
		#{goalMileage}, #{goalEntry}, #{userVO.id}, #{joinPostGroupVO.jpGroupNo})
	</insert>
	
	<!-- 재능기부 게시글 목록 -->	
	<select id="readDonationList" resultType="joinPostListVO" resultMap="jpRM">
		select j.jp_no, j.jp_title, j.jp_contents, j.jp_summary, j.jp_place, j.jp_app_start_date, j.jp_app_end_date,
			j.jp_event_start_date, j.jp_event_end_date, j.jp_imgdirectory, j.jp_regdate, j.jp_goal_mileage, j.jp_total_mileage,
			j.jp_goal_entry, j.jp_total_entry, j.jp_status, j.id, j.jp_group_no, j.jp_progress 
		from (select 
				row_number() over (order by jp_no desc) as rnum, jp_no, jp_title, jp_contents, jp_summary, jp_place, jp_app_start_date, jp_app_end_date,
				jp_event_start_date, jp_event_end_date, jp_imgdirectory, jp_regdate, jp_goal_mileage, jp_total_mileage,
				jp_goal_entry, jp_total_entry, jp_status, id, jp_group_no, jp_progress 
			from join_post
			where jp_group_no='1' and jp_progress='2' and jp_status='승인'
		)j, join_post jp
		where j.jp_no=jp.jp_no and rnum between #{startRowNumber} and #{endRowNumber}
		order by j.jp_no desc	
	</select>
	
	<!-- 승인된 재능기부 게시물 수 -->
	<select id="readDonationCount" resultType="int" parameterType="pagingBeanFive">
		select count(*)
		from join_post
		where jp_group_no='1' and jp_progress='2' and jp_status='승인' 
	</select>

</mapper>