<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user">
	<resultMap type="userVO" id="userRM">
		<result property="userGroupVO.ugroupNo" column="ugroup_no" />
		<result property="userGroupVO.ugroupName" column="ugroup_name" />
		<result property="userGradeVO.ugradeNo" column="ugrade_no" />
		<result property="userGradeVO.ugradeName" column="ugrade_name" />
	</resultMap>
	<resultMap type="activityVO" id="activityRM">
		<result property="aNo" column="u_no"/>
		<result property="aRegdate" column="u_regdate"/>
		<result property="aMileage" column="u_mileage"/>
		<result property="joinPostVO.jpNo" column="jp_no"/>
		<result property="joinPostVO.jpTitle" column="jp_title"/>
		<result property="userVO.id" column="id"/>
	</resultMap>
	<select id="checkId" parameterType="string" resultMap="userRM">
		<!-- inner join 쿼리 -->
		select u.id, u.password, u.name, u.gender, u.address, u.email, u.birthday, 
		u.company_no as companyNo, u.mileage, u.total_use_mileage as totalUseMileage,
		gro.ugroup_no, gro.ugroup_name, gra.ugrade_no, gra.ugrade_name
		from users u
		inner join users_group gro on u.ugroup_no=gro.ugroup_no
		inner join users_grade gra on u.ugrade_no=gra.ugrade_no
		and u.id=#{value}
	</select>
	<update id="updatePassword" parameterType="userVO">
		update users set password=#{password}
		where id=#{id}
	</update>
	<update id="updateUser" parameterType="userVO">
		update users set address=#{address}, email=#{email}
		where id=#{id}
	</update>
	<update id="deleteUser" parameterType="string">
 		update users set ugroup_no = '5'
		where id=#{value}
 	</update>
 	<select id="readMyActivityCount" resultType="int">
 		select count(*) 
		from users_activity
		where id=#{value}
 	</select>
 	<select id="readMyActivityList" resultType="activityVO" resultMap="activityRM" parameterType="pagingBeanFive">
 		select j.u_no, j.u_regdate, j.u_mileage, p.jp_title from (
		select row_number() over (order by u_no desc) as rnum, u_no, to_char(u_regdate,'YYYY.MM.DD') as u_regdate, u_mileage,jp_no
		from USERS_ACTIVITY where id=#{id}) j, JOIN_POST p
		where j.jp_no=p.jp_no and rnum between #{startRowNumber} and #{endRowNumber}
		order by j.jp_no desc
 	</select>
 	<select id="readMyApplicationCount" resultType="int">
 		select count(*) 
		from join_post
		where id=#{value}
 	</select>
 	<select id="readMyApplicationList" resultType="joinPostVO" parameterType="pagingBeanFive">
 		select jp_no, jp_title, jp_regdate, jp_status
		from (select row_number() over (order by jp_no desc) as rnum, jp_no, jp_title, to_char(jp_regdate,'YYYY.MM.DD') as jp_regdate, jp_status, id, jp_group_no
		from join_post)
		where id=#{id} and jp_group_no='1' and rnum between #{startRowNumber} and #{endRowNumber}
 	</select>
</mapper>